<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>×©×•××¨×™ ×”×ª×§×•×•×” â€” ××©×—×§ ×“×¤×“×¤×Ÿ ×—×™× ×•×›×™</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --accent: #38bdf8;
      --accent-soft: #7dd3fc;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --danger: #ef4444;
      --ok: #22c55e;
      --tile: #1f2937;
      --wall: #334155;
      --goal: #f59e0b;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: radial-gradient(circle at top, #1e293b, var(--bg));
      color: var(--text);
      min-height: 100vh;
    }

    .app {
      max-width: 980px;
      margin: 0 auto;
      padding: 16px;
      display: grid;
      gap: 14px;
    }

    .panel {
      background: rgba(17, 24, 39, 0.92);
      border: 1px solid #263244;
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
    }

    h1 { margin: 0 0 8px; font-size: 1.45rem; }
    p { margin: 0; line-height: 1.45; color: var(--muted); }

    .hud {
      display: grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap: 8px;
      margin-top: 10px;
    }

    .stat {
      background: #0b1220;
      border: 1px solid #2b3648;
      border-radius: 10px;
      padding: 8px;
      text-align: center;
      font-weight: bold;
      color: var(--accent-soft);
    }

    .board-wrap {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      justify-items: center;
    }

    #board {
      display: grid;
      gap: 2px;
      background: #0b1220;
      padding: 8px;
      border-radius: 10px;
      border: 1px solid #334155;
      width: min(94vw, 560px);
      aspect-ratio: 1 / 1;
    }

    .tile {
      border-radius: 5px;
      position: relative;
      font-size: clamp(12px, 1.8vw, 20px);
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
    }

    .floor { background: var(--tile); }
    .wall { background: var(--wall); }
    .player { background: #0ea5e9; }
    .patrol { background: #7f1d1d; }
    .item { background: #14532d; }
    .safe { background: #854d0e; }

    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
      font-size: .92rem;
      color: var(--muted);
    }

    .dot {
      width: 14px;
      height: 14px;
      border-radius: 4px;
      display: inline-block;
      margin-left: 4px;
      vertical-align: -2px;
    }

    .controls {
      display: grid;
      gap: 7px;
      justify-content: center;
      margin-top: 8px;
    }

    .row { display: flex; justify-content: center; gap: 7px; }

    button {
      border: 1px solid #32506b;
      background: #0b3b5a;
      color: #dbeafe;
      padding: 10px 14px;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 700;
      min-width: 56px;
      cursor: pointer;
    }
    button:active { transform: scale(0.98); }

    .cta {
      background: #0b4a6f;
      border-color: #3f89b5;
      margin-top: 10px;
      width: 100%;
    }

    .msg {
      margin-top: 10px;
      min-height: 26px;
      font-weight: 700;
      color: var(--accent-soft);
    }

    .note {
      margin-top: 8px;
      font-size: .9rem;
      color: #cbd5e1;
    }

    @media (max-width: 680px) {
      .hud { grid-template-columns: repeat(2, minmax(0,1fr)); }
      h1 { font-size: 1.2rem; }
      p { font-size: 0.95rem; }
    }
  </style>
</head>
<body>
  <main class="app">
    <section class="panel">
      <h1>×©×•××¨×™ ×”×ª×§×•×•×” â€” ××©×—×§ ×–×™×›×¨×•×Ÿ ×—×™× ×•×›×™</h1>
      <p>
        ×‘× ×™×ª×™ ×¢×‘×•×¨×š ×’×¨×¡×” ××›×‘×“×ª ×•××•×ª×××ª ×œ×›×œ ××›×©×™×¨ (×›×•×œ×œ ×˜×œ×¤×•×Ÿ) ×©×¨×¦×” ×™×©×™×¨×•×ª ×‘Ö¾HTML ×•××ª××™××” ×œÖ¾GitHub Pages.
        ××˜×¨×ª ×”××©×—×§: ×œ×¡×™×™×¢ ×œ×§×”×™×œ×” ×œ×©×¨×•×“, ×œ××¡×•×£ ××¡×¤×§×” ×•××¡×¨×™×, ×•×œ×”×’×™×¢ ×œ× ×§×•×“×ª ××§×œ×˜ ×‘×œ×™ ××œ×™××•×ª.
      </p>
      <div class="hud">
        <div class="stat">×©×œ×‘: <span id="level">1</span></div>
        <div class="stat">×—×™×™×: <span id="lives">3</span></div>
        <div class="stat">×¤×¨×™×˜×™×: <span id="items">0/3</span></div>
        <div class="stat">× ×™×§×•×“: <span id="score">0</span></div>
      </div>
    </section>

    <section class="panel board-wrap">
      <div id="board" aria-label="×œ×•×— ××©×—×§"></div>
      <div class="legend">
        <span><i class="dot" style="background:#0ea5e9"></i>×©×—×§×Ÿ</span>
        <span><i class="dot" style="background:#14532d"></i>×¤×¨×™×˜</span>
        <span><i class="dot" style="background:#7f1d1d"></i>×¡×™×•×¨ ×“×™×›×•×™</span>
        <span><i class="dot" style="background:#854d0e"></i>××§×œ×˜</span>
        <span><i class="dot" style="background:#334155"></i>××—×¡×•×</span>
      </div>
      <div class="controls">
        <div class="row"><button data-move="up">â¬†</button></div>
        <div class="row">
          <button data-move="right">â¡</button>
          <button data-move="down">â¬‡</button>
          <button data-move="left">â¬…</button>
        </div>
      </div>
      <button id="restart" class="cta">×”×ª×—×œ ××©×—×§ ××—×“×©</button>
      <div id="msg" class="msg"></div>
      <p class="note">××§×©×™× ×‘××—×©×‘: ×—×¦×™× / WASD. ×‘×˜×œ×¤×•×Ÿ: ×”×©×ª××© ×‘×›×¤×ª×•×¨×™ ×”××’×¢.</p>
    </section>
  </main>

  <script>
    const SIZE = 12;
    const WALL = "#";
    const FLOOR = ".";

    const state = {
      level: 1,
      lives: 3,
      score: 0,
      player: { x: 1, y: 1 },
      safeZone: { x: SIZE - 2, y: SIZE - 2 },
      items: [],
      patrols: [],
      board: [],
      running: true
    };

    const boardEl = document.getElementById("board");
    const msgEl = document.getElementById("msg");

    function randInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function makeBoard() {
      const board = Array.from({ length: SIZE }, () => Array(SIZE).fill(FLOOR));

      for (let y = 0; y < SIZE; y++) {
        for (let x = 0; x < SIZE; x++) {
          if (x === 0 || y === 0 || x === SIZE - 1 || y === SIZE - 1) {
            board[y][x] = WALL;
          }
        }
      }

      const walls = 20 + state.level * 4;
      for (let i = 0; i < walls; i++) {
        const x = randInt(1, SIZE - 2);
        const y = randInt(1, SIZE - 2);
        if ((x === 1 && y === 1) || (x === SIZE - 2 && y === SIZE - 2)) continue;
        board[y][x] = WALL;
      }

      state.board = board;
    }

    function randomFreeCell() {
      while (true) {
        const x = randInt(1, SIZE - 2);
        const y = randInt(1, SIZE - 2);
        if (state.board[y][x] !== FLOOR) continue;
        const occupied =
          (state.player.x === x && state.player.y === y) ||
          state.items.some(i => i.x === x && i.y === y) ||
          state.patrols.some(p => p.x === x && p.y === y) ||
          (state.safeZone.x === x && state.safeZone.y === y);
        if (!occupied) return { x, y };
      }
    }

    function setupLevel() {
      state.player = { x: 1, y: 1 };
      state.safeZone = { x: SIZE - 2, y: SIZE - 2 };
      state.items = [];
      state.patrols = [];
      makeBoard();

      const itemCount = 3;
      for (let i = 0; i < itemCount; i++) state.items.push(randomFreeCell());

      const patrolCount = Math.min(2 + state.level, 7);
      for (let i = 0; i < patrolCount; i++) {
        const cell = randomFreeCell();
        state.patrols.push({ ...cell, dir: ["up", "down", "left", "right"][randInt(0, 3)] });
      }

      setMessage("××¡×•×£ ××ª ×›×œ ×”×¤×¨×™×˜×™× ×•××– ×”×’×™×¢ ×œ××§×œ×˜.");
      render();
      updateHud();
    }

    function tileClass(x, y) {
      const isWall = state.board[y][x] === WALL;
      if (isWall) return "tile wall";
      if (state.player.x === x && state.player.y === y) return "tile player";
      if (state.patrols.some(p => p.x === x && p.y === y)) return "tile patrol";
      if (state.items.some(i => i.x === x && i.y === y)) return "tile item";
      if (state.safeZone.x === x && state.safeZone.y === y) return "tile safe";
      return "tile floor";
    }

    function tileSymbol(x, y) {
      if (state.player.x === x && state.player.y === y) return "ğŸ™‚";
      if (state.patrols.some(p => p.x === x && p.y === y)) return "âš ";
      if (state.items.some(i => i.x === x && i.y === y)) return "ğŸ“¦";
      if (state.safeZone.x === x && state.safeZone.y === y) return "ğŸ ";
      if (state.board[y][x] === WALL) return "";
      return "";
    }

    function render() {
      boardEl.style.gridTemplateColumns = `repeat(${SIZE}, 1fr)`;
      boardEl.innerHTML = "";
      for (let y = 0; y < SIZE; y++) {
        for (let x = 0; x < SIZE; x++) {
          const cell = document.createElement("div");
          cell.className = tileClass(x, y);
          cell.textContent = tileSymbol(x, y);
          boardEl.appendChild(cell);
        }
      }
    }

    function setMessage(text, danger = false) {
      msgEl.textContent = text;
      msgEl.style.color = danger ? "#fca5a5" : "#7dd3fc";
    }

    function updateHud() {
      document.getElementById("level").textContent = state.level;
      document.getElementById("lives").textContent = state.lives;
      document.getElementById("score").textContent = state.score;
      document.getElementById("items").textContent = `${3 - state.items.length}/3`;
    }

    function canMove(x, y) {
      return state.board[y] && state.board[y][x] && state.board[y][x] !== WALL;
    }

    function movePlayer(dir) {
      if (!state.running) return;

      const delta = {
        up: [0, -1],
        down: [0, 1],
        left: [-1, 0],
        right: [1, 0]
      }[dir];
      if (!delta) return;

      const [dx, dy] = delta;
      const nx = state.player.x + dx;
      const ny = state.player.y + dy;
      if (!canMove(nx, ny)) return;

      state.player.x = nx;
      state.player.y = ny;

      const before = state.items.length;
      state.items = state.items.filter(i => !(i.x === nx && i.y === ny));
      if (state.items.length < before) {
        state.score += 25;
        setMessage("× ××¡×£ ×¤×¨×™×˜ ×—×™×•× ×™ ×œ×§×”×™×œ×”!");
      }

      movePatrols();
      checkCollisions();
      checkWin();
      updateHud();
      render();
    }

    function directionToDelta(dir) {
      return {
        up: [0, -1],
        down: [0, 1],
        left: [-1, 0],
        right: [1, 0]
      }[dir];
    }

    function movePatrols() {
      for (const p of state.patrols) {
        let [dx, dy] = directionToDelta(p.dir);
        let nx = p.x + dx;
        let ny = p.y + dy;

        if (!canMove(nx, ny)) {
          const dirs = ["up", "down", "left", "right"].sort(() => Math.random() - 0.5);
          for (const d of dirs) {
            const [tx, ty] = directionToDelta(d);
            if (canMove(p.x + tx, p.y + ty)) {
              p.dir = d;
              nx = p.x + tx;
              ny = p.y + ty;
              break;
            }
          }
        }

        p.x = nx;
        p.y = ny;

        if (Math.random() < 0.15) {
          p.dir = ["up", "down", "left", "right"][randInt(0, 3)];
        }
      }
    }

    function checkCollisions() {
      const hit = state.patrols.some(p => p.x === state.player.x && p.y === state.player.y);
      if (!hit) return;

      state.lives -= 1;
      state.score = Math.max(0, state.score - 30);
      if (state.lives <= 0) {
        state.running = false;
        setMessage("×”××©×—×§ ×”×¡×ª×™×™×. × ×¡×” ×©×•×‘ ×•×œ×©××•×¨ ×¢×œ ×”×ª×§×•×•×”.", true);
      } else {
        state.player = { x: 1, y: 1 };
        setMessage("× ×ª×¤×¡×ª ×‘×¡×™×•×¨ â€” ×—×–×¨×ª ×œ× ×§×•×“×ª ×”×ª×—×œ×”.", true);
      }
    }

    function checkWin() {
      const atSafe = state.player.x === state.safeZone.x && state.player.y === state.safeZone.y;
      if (!atSafe || state.items.length > 0) return;

      state.level += 1;
      state.score += 100;
      setMessage("×›×œ ×”×›×‘×•×“! ×¢×‘×¨×ª ×©×œ×‘.");
      setupLevel();
    }

    document.querySelectorAll("button[data-move]").forEach(btn => {
      btn.addEventListener("click", () => movePlayer(btn.dataset.move));
    });

    window.addEventListener("keydown", (e) => {
      const map = {
        ArrowUp: "up", ArrowDown: "down", ArrowLeft: "left", ArrowRight: "right",
        w: "up", a: "left", s: "down", d: "right",
        W: "up", A: "left", S: "down", D: "right"
      };
      const dir = map[e.key];
      if (!dir) return;
      e.preventDefault();
      movePlayer(dir);
    }, { passive: false });

    document.getElementById("restart").addEventListener("click", () => {
      state.level = 1;
      state.lives = 3;
      state.score = 0;
      state.running = true;
      setupLevel();
    });

    setupLevel();
  </script>
</body>
</html>
